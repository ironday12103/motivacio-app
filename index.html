<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Motiv√°ci√≥ App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
 margin:0;
 background:#000;
 color:#fff;
 font-family:Arial,Helvetica,sans-serif;
 display:flex;
 justify-content:center;
 align-items:center;
 height:100vh;
}
.app{
 width:100%;
 max-width:480px;
 height:96vh;
 background:#111;
 border-radius:28px;
 padding:18px;
 box-shadow:0 0 40px rgba(0,0,0,.9);
 overflow:auto;
}
.tabs{
 display:flex;
 gap:6px;
 margin-bottom:10px;
}
.tabs button{
 flex:1;
 border:none;
 border-radius:14px;
 padding:10px;
 background:#333;
 color:#fff;
 font-size:13px;
}
.tabs button.active{
 background:#ff9800;
 color:#000;
}
.view{display:none;}
.view.active{display:block;}

.stat-tabs{
 display:flex;
 gap:6px;
 margin-bottom:10px;
}
.stat-tabs button{
 flex:1;
 border:none;
 border-radius:14px;
 padding:10px;
 background:#333;
 color:#fff;
}
.stat-tabs button.active{
 background:#ff9800;
 color:#000;
}

#statChart{
 width:100%;
 height:240px;
 display:block;
}

.header-quote{text-align:center;font-size:14px;margin-bottom:8px;opacity:.9;}

.motivation-card{
 background:linear-gradient(135deg,#ff9800,#ff5722,#9c27b0);
 border-radius:22px;
 padding:14px;
 text-align:center;
}
.motivation-card img{
 width:100%;
 height:40vh;
 max-height:320px;
 object-fit:cover;
 border-radius:16px;
}
#authorTag{
 display:inline-block;
 padding:6px 14px;
 border-radius:16px;
 font-weight:bold;
 background:#222;
 color:#ff9800;
 margin-bottom:6px;
}
.big-quote{font-size:26px;font-weight:bold;}

textarea,input,select{
 width:100%;
 padding:12px;
 border-radius:14px;
 border:none;
 margin-top:8px;
}

button{
 width:100%;
 padding:12px;
 border:none;
 border-radius:14px;
 margin-top:8px;
}
.main{background:#ff9800;color:#000;}
.secondary{background:#333;color:#fff;}

.card{background:#1d1d1d;border-radius:16px;padding:12px;margin-bottom:8px;}
.stat-box{background:#222;border-radius:16px;padding:12px;margin-bottom:8px;}
</style>
</head>

<body>
<div class="app">

<div class="tabs">
 <button class="active" onclick="tab(this,'mot')">üî•</button>
 <button onclick="tab(this,'nap')">üìì</button>
 <button onclick="tab(this,'sport')">üèãÔ∏è</button>
 <button onclick="tab(this,'book')">üìö</button>
 <button onclick="tab(this,'stat')">üìä</button>
</div>

<div class="header-quote" id="dailyQuote"></div>

<div id="mot" class="view active">
 <div class="motivation-card">
  <img id="motImg" alt="Motiv√°ci√≥s k√©p">
  <div id="authorTag"></div>
  <div class="big-quote" id="quote"></div>
 </div>
 <button class="main" onclick="newQuote()">√öj motiv√°ci√≥</button>
</div>

<div id="nap" class="view">
 <textarea id="journal" placeholder="√çrd le a napod..." oninput="countJournalChars()"></textarea>
 <div class="card">Karakterek: <b><span id="charCount">0</span> / 90</b></div>
 <button class="secondary" id="saveJournalBtn" onclick="saveJournal()" disabled>Ment√©s</button>
</div>

<div id="sport" class="view">
 <select id="stype"><option>Fut√°s</option><option>S√∫lyz√≥s</option></select>
 <button class="secondary" onclick="saveSport()">Ment√©s</button>
</div>

<div id="book" class="view">
 <input id="btitle" placeholder="K√∂nyv c√≠me">
 <button class="secondary" onclick="saveBook()">Ment√©s</button>
</div>

<div id="stat" class="view">
 <div class="stat-tabs">
  <button id="weekBtn" class="active" onclick="switchStat('week')">Heti</button>
  <button id="yearBtn" onclick="switchStat('year')">√âves</button>
 </div>

 <canvas id="statChart"></canvas>

 <div class="stat-box" id="statWrite"></div>
 <div class="stat-box" id="statSport"></div>
 <div class="stat-box" id="statBook"></div>

 <div class="card"><b>Napl√≥k</b><div id="statJournalList"></div></div>
 <div class="card"><b>Edz√©sek</b><div id="statSportList"></div></div>
 <div class="card"><b>K√∂nyvek</b><div id="statBookList"></div></div>
</div>

</div>

<script>
/*
 Jav√≠tott v√°ltozat:
 - Explicit DOM lek√©r√©sek (document.getElementById), nem az id-kb≈ël k√©pzett glob√°lis v√°ltoz√≥kra t√°maszkodva.
 - localStorage.getItem/setItem haszn√°lata.
 - Chart.js-nek egy√©rtelm≈± canvas elemet adunk.
 - Alap valid√°ci√≥k √©s kis UX jav√≠t√°sok (mez≈ëk t√∂rl√©se ment√©s ut√°n, alt attrib√∫tum).
*/

const quotes=[
 {a:"David Goggins",t:"A f√°jdalom ideiglenes.",i:"https://images.unsplash.com/photo-1517836357463-d25dfeac3438"},
 {a:"Elon Musk",t:"Ha fontos, megcsin√°lod.",i:"https://images.unsplash.com/photo-1518770660439-4636190af475"}
];

let statMode="week";
let statChartObj=null;

// Objektum a DOM elemek t√°rol√°s√°ra
const DOM = {};

function initDOM(){
 DOM.quote = document.getElementById('quote');
 DOM.motImg = document.getElementById('motImg');
 DOM.authorTag = document.getElementById('authorTag');
 DOM.dailyQuote = document.getElementById('dailyQuote');

 DOM.journal = document.getElementById('journal');
 DOM.charCount = document.getElementById('charCount');
 DOM.saveJournalBtn = document.getElementById('saveJournalBtn');

 DOM.stype = document.getElementById('stype');

 DOM.btitle = document.getElementById('btitle');

 DOM.weekBtn = document.getElementById('weekBtn');
 DOM.yearBtn = document.getElementById('yearBtn');

 DOM.statWrite = document.getElementById('statWrite');
 DOM.statSport = document.getElementById('statSport');
 DOM.statBook = document.getElementById('statBook');

 DOM.statJournalList = document.getElementById('statJournalList');
 DOM.statSportList = document.getElementById('statSportList');
 DOM.statBookList = document.getElementById('statBookList');

 DOM.statChart = document.getElementById('statChart');
}

function tab(btn,id){
 document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
 btn.classList.add("active");
 document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 if(id==="stat") setTimeout(loadStats,200);
}

function newQuote(){
 let q=quotes[Math.floor(Math.random()*quotes.length)];
 if(DOM.quote) DOM.quote.innerText=q.t;
 if(DOM.motImg){
  DOM.motImg.src=q.i;
  DOM.motImg.alt = q.t;
 }
 if(DOM.authorTag) DOM.authorTag.innerText=q.a;
 if(DOM.dailyQuote) DOM.dailyQuote.innerText=q.t+" ‚Äì "+q.a;
}

function countJournalChars(){
 if(!DOM.charCount || !DOM.journal || !DOM.saveJournalBtn) return;
 const len = DOM.journal.value.length;
 DOM.charCount.innerText = len;
 DOM.saveJournalBtn.disabled = len < 90;
}

function saveJournal(){
 if(!DOM.journal) return;
 if(DOM.journal.value.length<90) return;
 let j = JSON.parse(localStorage.getItem('journal') || "[]");
 j.push({text:DOM.journal.value,date:Date.now()});
 localStorage.setItem('journal', JSON.stringify(j));
 DOM.journal.value="";
 countJournalChars();
 // friss√≠ts√ºk a stat n√©zetet ha nyitva van
 if(document.getElementById('stat').classList.contains('active')) loadStats();
}

function saveSport(){
 if(!DOM.stype) return;
 const type = DOM.stype.value ? DOM.stype.value.trim() : "";
 if(!type) return; // ne ments√ºnk √ºres t√≠pust
 let s = JSON.parse(localStorage.getItem('sport') || "[]");
 s.push({type:type,date:Date.now()});
 localStorage.setItem('sport', JSON.stringify(s));
 // friss√≠ts√ºk a stat n√©zetet ha nyitva van
 if(document.getElementById('stat').classList.contains('active')) loadStats();
}

function saveBook(){
 if(!DOM.btitle) return;
 const title = DOM.btitle.value ? DOM.btitle.value.trim() : "";
 if(!title) return; // ne ments√ºnk √ºres c√≠met
 let b = JSON.parse(localStorage.getItem('book') || "[]");
 b.push({title:title,date:Date.now()});
 localStorage.setItem('book', JSON.stringify(b));
 DOM.btitle.value="";
 if(document.getElementById('stat').classList.contains('active')) loadStats();
}

function switchStat(m){
 statMode=m;
 if(DOM.weekBtn) DOM.weekBtn.classList.toggle("active",m==="week");
 if(DOM.yearBtn) DOM.yearBtn.classList.toggle("active",m==="year");
 loadStats();
}

function loadStats(){
 const now=Date.now(),week=7*864e5;
 const j=JSON.parse(localStorage.getItem('journal') || "[]");
 const s=JSON.parse(localStorage.getItem('sport') || "[]");
 const b=JSON.parse(localStorage.getItem('book') || "[]");

 const jf=statMode==="week"?j.filter(x=>now-x.date<week):j;
 const sf=statMode==="week"?s.filter(x=>now-x.date<week):s;
 const bf=statMode==="week"?b.filter(x=>now-x.date<week):b;

 if(DOM.statWrite) DOM.statWrite.innerText=`üìì Napl√≥k: ${jf.length}`;
 if(DOM.statSport) DOM.statSport.innerText=`üèãÔ∏è Edz√©sek: ${sf.length}`;
 if(DOM.statBook) DOM.statBook.innerText=`üìö K√∂nyvek: ${bf.length}`;

 if(statChartObj) statChartObj.destroy();
 // statChart lehet canvas element, adjuk √°t explicit m√≥don
 if(DOM.statChart){
  statChartObj=new Chart(DOM.statChart,{
   type:"bar",
   data:{labels:["Napl√≥","Edz√©s","K√∂nyv"],datasets:[{data:[jf.length,sf.length,bf.length],backgroundColor:['#ff9800','#ff5722','#9c27b0']}]},
   options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
 }

 if(DOM.statJournalList) DOM.statJournalList.innerHTML=jf.map(x=>`<div class="card">${escapeHtml(x.text)}</div>`).join("");
 if(DOM.statSportList) DOM.statSportList.innerHTML=sf.map(x=>`<div class="card">${escapeHtml(x.type)}</div>`).join("");
 if(DOM.statBookList) DOM.statBookList.innerHTML=bf.map(x=>`<div class="card">${escapeHtml(x.title)}</div>`).join("");
}

// egyszer≈± HTML escape, hogy elker√ºlj√ºk az XSS megjelen√≠t√©st a napl√≥kn√°l
function escapeHtml(str){
 if(!str) return "";
 return String(str)
  .replace(/&/g, '&amp;')
  .replace(/</g, '&lt;')
  .replace(/>/g, '&gt;')
  .replace(/"/g, '&quot;')
  .replace(/'/g, '&#39;');
}

document.addEventListener('DOMContentLoaded', ()=>{
 initDOM();
 newQuote();
 countJournalChars();
 // ha stat n√©zet akt√≠v kezdetben, t√∂lts√ºk be a statisztik√°kat
 if(document.getElementById('stat').classList.contains('active')) loadStats();
});
</script>
</body>
</html>
